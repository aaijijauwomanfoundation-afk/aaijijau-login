
</script>
   window.SUPABASE_URL = "https://hjtmqutbqodicjupgsxn.supabase.co";
  window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdG1xdXRicW9kaWNqdXBnc3huIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NDM1OTU2NiwiZXhwIjoyMDc5OTM1NTY2fQ.8RXY7u4gZyD3MIP7iN1bwwDkSqw15aD2jlQskfi5AS4";
</script>
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// --- Supabase Config ---
const SUPABASE_URL = window.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdG1xdXRicW9kaWNqdXBnc3huIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNTk1NjYsImV4cCI6MjA3OTkzNTU2Nn0.NSm0ACU5YFc78e8Ck0PvCNLFaido3noRkJC_7vRMrrU;
const SUPABASE_ANON_KEY = window.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdG1xdXRicW9kaWNqdXBnc3huIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NDM1OTU2NiwiZXhwIjoyMDc5OTM1NTY2fQ.8RXY7u4gZyD3MIP7iN1bwwDkSqw15aD2jlQskfi5AS4;

if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
  console.error("âŒ SUPABASE ENV Keys Missing!");
  document.getElementById("status").innerText = "âŒ Supabase Keys à¤¸à¥‡à¤Ÿ à¤•à¥‡à¤²à¥‡à¤²à¥‡ à¤¨à¤¾à¤¹à¥€!";
}

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// --- Auto Session Check (Login Guard) ---
async function checkSession() {
  try {
    const { data } = await supabase.auth.getSession();
    if (data.session) {
      document.getElementById("status").innerText = "âœ… à¤†à¤§à¥€à¤š à¤²à¥‰à¤—à¤¿à¤¨ à¤†à¤¹à¥‡... Redirecting!";
      setTimeout(() => {
        window.location.href = "dashboard.html";
      }, 1200);
    } else {
      document.getElementById("status").innerText = "ðŸ” à¤²à¥‰à¤—à¤¿à¤¨ à¤•à¤°à¤£à¥à¤¯à¤¾à¤¸à¤¾à¤ à¥€ OTP à¤®à¤¾à¤—à¤µà¤¾!";
    }
  } catch (err) {
    document.getElementById("status").innerText = "âŒ Session check error!";
    console.error(err);
  }
}

// Page load à¤µà¤° session à¤¤à¤ªà¤¾à¤¸à¤¾
checkSession();

// --- Send OTP Function ---
async function sendOTP() {
  const mobile = document.getElementById("mobile").value.trim();

  if (!mobile || mobile.length !== 10) {
    document.getElementById("status").innerText = "âš  à¤•à¥ƒà¤ªà¤¯à¤¾ 10 à¤…à¤‚à¤•à¥€ Mobile à¤¨à¤‚à¤¬à¤° à¤Ÿà¤¾à¤•à¤¾!";
    return;
  }

  document.getElementById("status").innerText = "â³ OTP à¤ªà¤¾à¤ à¤µà¤¤ à¤†à¤¹à¥‡...";

  const { error } = await supabase.auth.signInWithOtp({
    phone: "+91" + mobile,
  });

  if (error) {
    document.getElementById("status").innerText = "âŒ OTP Error: " + error.message;
  } else {
    document.getElementById("status").innerText = "ðŸ“© OTP à¤ªà¤¾à¤ à¤µà¤²à¤¾ à¤†à¤¹à¥‡! SMS à¤¤à¤ªà¤¾à¤¸à¤¾.";
    setTimeout(() => {
      window.location.href = "otp.html";
    }, 1000);
  }
}

// --- Button Event Listener ---
document.getElementById("loginBtn")?.addEventListener("click", sendOTP);
