
</script>
   window.SUPABASE_URL = "https://hjtmqutbqodicjupgsxn.supabase.co";
  window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdG1xdXRicW9kaWNqdXBnc3huIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NDM1OTU2NiwiZXhwIjoyMDc5OTM1NTY2fQ.8RXY7u4gZyD3MIP7iN1bwwDkSqw15aD2jlQskfi5AS4";
</script>

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// HTML head ‡§Æ‡§ß‡•Ç‡§® keys ‡§ò‡•á‡§§ ‡§Ü‡§π‡•ã‡§§
const SUPABASE_URL = window.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdG1xdXRicW9kaWNqdXBnc3huIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNTk1NjYsImV4cCI6MjA3OTkzNTU2Nn0.NSm0ACU5YFc78e8Ck0PvCNLFaido3noRkJC_7vRMrrU;
const SUPABASE_ANON_KEY = window.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdG1xdXRicW9kaWNqdXBnc3huIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NDM1OTU2NiwiZXhwIjoyMDc5OTM1NTY2fQ.8RXY7u4gZyD3MIP7iN1bwwDkSqw15aD2jlQskfi5AS4;

const statusEl = document.getElementById("status");

// ‡§ú‡§∞ keys ‡§®‡§æ‡§π‡•Ä‡§§ ‡§§‡§∞ error ‡§¶‡§æ‡§ñ‡§µ‡§æ
if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
  console.error("‚ùå Supabase keys missing!");
  if (statusEl) statusEl.innerText = "‚ùå SUPABASE Keys missing in HTML head!";
}

// Supabase client ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Session ‡§§‡§™‡§æ‡§∏‡§£‡•Ä
async function checkSession() {
  if (!statusEl) return;
  statusEl.innerText = "‚è≥ Session check‚Ä¶";

  try {
    const { data, error } = await supabase.auth.getSession();
    if (error) throw error;

    if (data.session) {
      statusEl.innerText = "‚úÖ ‡§Ü‡§ß‡•Ä‡§ö ‡§≤‡•â‡§ó‡§ø‡§® ‡§Ü‡§π‡•á, Dashboard ‡§≤‡§æ ‡§ú‡§æ‡§§ ‡§Ü‡§π‡•á‚Ä¶";
      setTimeout(() => {
        window.location.href = "dashboard.html";
      }, 1200);
    } else {
      statusEl.innerText = "‚ùå ‡§≤‡•â‡§ó‡§ø‡§® ‡§®‡§æ‡§π‡•Ä, OTP ‡§Æ‡§æ‡§ó‡§µ‡§æ.";
    }

  } catch (err) {
    console.error("Session error:", err);
    statusEl.innerText = "‚ùå Session check failed!";
  }
}

// OTP ‡§Æ‡§æ‡§ó‡§µ‡§£‡•á (Passwordless Phone Login)
async function sendOTP() {
  if (!statusEl) return;
  const mobile = document.getElementById("mobile")?.value;

  if (!mobile || mobile.length !== 10) {
    statusEl.innerText = "‚ö† 10 ‡§Ö‡§Ç‡§ï‡•Ä Mobile ‡§®‡§Ç‡§¨‡§∞ ‡§ü‡§æ‡§ï‡§æ!";
    return;
  }

  statusEl.innerText = "üì© OTP ‡§™‡§æ‡§†‡§µ‡§§ ‡§Ü‡§π‡•ã‡§§‚Ä¶";

  const { error } = await supabase.auth.signInWithOtp({
    phone: "+91" + mobile,
  });

  if (error) {
    console.error("OTP error:", error);
    statusEl.innerText = "‚ùå OTP ‡§™‡§æ‡§†‡§µ‡§£‡•á ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä!";
  } else {
    statusEl.innerText = "‚úÖ OTP SMS ‡§™‡§æ‡§†‡§µ‡§≤‡§æ ‡§Ü‡§π‡•á, Verify ‡§™‡•á‡§ú‡§≤‡§æ ‡§ú‡§æ‡§§ ‡§Ü‡§π‡•á‚Ä¶";
    setTimeout(() => {
      window.location.href = "otp.html";
    }, 1200);
  }
}

// Button listener
document.getElementById("loginBtn")?.addEventListener("click", sendOTP);

// Auto run on page load
checkSession();

// ‡§π‡§µ‡•á ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§¨‡§æ‡§π‡•á‡§∞‡•Ç‡§® ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§Ø‡§æ‡§µ‡§æ ‡§Æ‡•ç‡§π‡§£‡•Ç‡§® attach
window.sendOTP = sendOTP;
window.checkSession = checkSession;
